<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Mike Lissner" />
        <meta name="copyright" content="Mike Lissner" />

        <link rel="author" href=https://plus.google.com/+MikeLissner />
        <meta name="twitter:creator" content="@mlissner">
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Tesseract, OCR, HowTo, Font, Tech, " />

<meta property="og:title" content="Adding New Fonts to Tesseract 3 OCR Engine "/>
<meta property="og:url" content="http://michaeljaylissner.com/posts/2012/02/11/adding-new-fonts-to-tesseract-3-ocr-engine/" />
<meta property="og:description" content="Status I’m attempting to keep this up to date as Tesseract changes. If you have corrections, please send them directly using the contact page. I’ve turned off commenting on this article because it was just a bunch of people asking for help and never getting any. If you ..." />
<meta property="og:site_name" content="Michael Jay Lissner" />
<meta property="og:article:author" content="Mike Lissner" />
<meta property="og:article:published_time" content="2012-02-11T10:53:30-08:00" />
<meta property="" content="2014-10-06T00:00:00-07:00" />
<meta name="twitter:title" content="Adding New Fonts to Tesseract 3 OCR Engine ">
<meta name="twitter:description" content="Status I’m attempting to keep this up to date as Tesseract changes. If you have corrections, please send them directly using the contact page. I’ve turned off commenting on this article because it was just a bunch of people asking for help and never getting any. If you ...">
<meta property="og:image" content="//localhost:8000/theme/images/apple-touch-icon-152x152.png" />
<meta name="twitter:image" content="//localhost:8000/theme/images/apple-touch-icon-152x152.png" >

        <title>Adding New Fonts to Tesseract 3 OCR Engine  · Michael Jay Lissner
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://michaeljaylissner.com/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://michaeljaylissner.com/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://michaeljaylissner.com/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://michaeljaylissner.com/theme/css/custom.css" media="screen">
        <link rel="shortcut icon" href="http://michaeljaylissner.com/theme/images/favicon.ico" type="image/x-icon" type="image/png" />
        <link rel="icon" href="http://michaeljaylissner.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="http://michaeljaylissner.com/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="http://michaeljaylissner.com/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="http://michaeljaylissner.com/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="http://michaeljaylissner.com/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="http://michaeljaylissner.com/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="http://michaeljaylissner.com/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="http://michaeljaylissner.com/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="http://michaeljaylissner.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link href="http://michaeljaylissner.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Michael Jay Lissner - Full Atom Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-55828430-1', 'auto');
    ga('send', 'pageview');
</script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <div class="span1"></div>
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://michaeljaylissner.com/"><span class=site-name>Michael Jay Lissner</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://michaeljaylissner.com">Home</a></li>
                                        <li ><a href="http://michaeljaylissner.com/about">About&nbsp;Site</a></li>
                                        <li ><a href="http://michaeljaylissner.com/contact">Contact</a></li>
                                        <li ><a href="http://michaeljaylissner.com/projects-and-papers">Projects <span class="amp">&amp;</span>&nbsp;Papers</a></li>
                            <li ><a href="http://michaeljaylissner.com/tags.html">Tags</a></li>
                            <li ><a href="http://michaeljaylissner.com/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://michaeljaylissner.com/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="http://michaeljaylissner.com/posts/2012/02/11/adding-new-fonts-to-tesseract-3-ocr-engine/"> Adding New Fonts to Tesseract 3 <span class="caps">OCR</span>&nbsp;Engine  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#status">Status</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#create-training-documents">Create training documents</a></li>
<li><a href="#train-tesseract">Train Tesseract</a></li>
<li><a href="#enclosures">Enclosures</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">

            
            
<h2 id="status">Status</h2>
<p>I’m attempting to keep this up to date as Tesseract changes. If you have 
corrections, please send them directly using the <a href="http://michaeljaylissner.com/contact">contact page</a>.</p>
<p>I’ve turned off commenting on this article because it was just a 
bunch of people asking for help and never getting any. If you need help 
with these instructions, go to <a href="https://stackoverflow.com/questions/tagged/tesseract">Stack Overflow</a> and ask there. If you send
me a link to a question on such a site, I’m much more likely to respond positively.</p>
<h2 id="introduction">Introduction</h2>
<p><a href="http://code.google.com/p/tesseract-ocr/">Tesseract</a> is a great and powerful <span class="caps">OCR</span> engine, but their <a href="http://code.google.com/p/tesseract-ocr/wiki/TrainingTesseract3">instructions 
for adding a new font</a> are incredibly long and complicated. At 
CourtListener we have to handle several unusual <a href="http://en.wikipedia.org/wiki/Blackletter">blackletter fonts</a>, 
so we had to go through this process a few times. Below I’ve explained the 
process so others may more easily add fonts to their system.</p>
<p>The process has a few major steps:</p>
<ul>
<li><a href="#create-training-documents">Create training documents</a></li>
<li><a href="#train-tesseract">Teach Tesseract about the documents</a></li>
</ul>
<h2 id="create-training-documents">Create training documents</h2>
<p>To create training documents, open up <span class="caps">MS</span> Word or LibreOffice, paste in the contents of the attached file named ‘standard-training-text.txt’. This file contains the training text that is used by Tesseract for the included fonts.</p>
<p>Set your line spacing to at least 1.5, and space out the letters by about 1pt. using character spacing. I’ve attached a sample doc too, if that helps. Set the text to the font you want to use, and save it as font-name.doc.</p>
<p>Save the document as a <span class="caps">PDF</span> (call it [lang].font-name.exp0.pdf, with lang being an <a href="http://www.sil.org/iso639-3/iso-639-3_Name_Index_20120203.tab"><span class="caps">ISO</span>-639 three letter abbreviation</a> for your language), and then use the following command to convert it to a 300dpi tiff (requires imagemagick):</p>
<p><code>convert -density 300 -depth 4 lang.font-name.exp0.pdf lang.font-name.exp0.tif</code></p>
<p>You’ll now have a good training image called lang.font-name.exp0.tif. If you’re adding multiple fonts, or bold, italic or underline, repeat this process multiple times, creating one doc → pdf →  tiff per font variation.</p>
<h2 id="train-tesseract">Train Tesseract</h2>
<p>The next step is to run tesseract over the image(s) we just created, and to see how well it can do with the new font. After it’s taken its best shot, we then give it corrections. It’ll provide us with a box file, which is just a file containing x,y coordinates of each letter it found along with what letter it thinks it is. So let’s see what it can do:</p>
<div class="highlight"><pre><span class="n">tesseract</span> <span class="n">lang</span><span class="p">.</span><span class="n">font</span><span class="o">-</span><span class="n">name</span><span class="p">.</span><span class="n">exp0</span><span class="p">.</span><span class="n">tiff</span> <span class="n">lang</span><span class="p">.</span><span class="n">font</span><span class="o">-</span><span class="n">name</span><span class="p">.</span><span class="n">exp0</span> <span class="n">batch</span><span class="p">.</span><span class="n">nochop</span> <span class="n">makebox</span>
</pre></div>
<p>You’ll now have a file called font-name.exp0.box, and you’ll need to open it in a box-file editor. There are a bunch of these <a href="http://code.google.com/p/tesseract-ocr/wiki/TrainingTesseract3#Box_File_Editors">on the Tesseract wiki</a>. The one that works for me (on Ubuntu) is <a href="http://code.google.com/p/moshpytt/">moshpytt</a>, though it doesn’t support multi-page tiffs. If you need to use a multi-page tiff, see <a href="http://code.google.com/p/moshpytt/issues/detail?id=2">the issue on the topic</a> for tips. Once you’ve opened it, go through <strong>every</strong> letter, and make sure it was detected correctly. If a letter was skipped, add it as a row to the box file. Similarly, if two letters were detected as one, break them up into two lines.</p>
<p>When that’s done, you feed the box file back into tesseract:</p>
<div class="highlight"><pre><span class="n">tesseract</span> <span class="n">eng</span><span class="p">.</span><span class="n">font</span><span class="o">-</span><span class="n">name</span><span class="p">.</span><span class="n">exp0</span><span class="p">.</span><span class="n">tif</span> <span class="n">eng</span><span class="p">.</span><span class="n">font</span><span class="o">-</span><span class="n">name</span><span class="p">.</span><span class="n">box</span> <span class="n">nobatch</span> <span class="n">box</span><span class="p">.</span><span class="n">train</span> <span class="p">.</span><span class="n">stderr</span>
</pre></div>
<p>Next, you need to detect the Character set used in all your box files:</p>
<div class="highlight"><pre><span class="n">unicharset_extractor</span> <span class="o">*</span><span class="p">.</span><span class="n">box</span>
</pre></div>
<p>When that’s complete, you need to create a <code>font_properties</code> file. It should list every font you’re training, one per line, and identify whether it has the following characteristics: &lt;fontname&gt; &lt;italic&gt; &lt;bold&gt; &lt;fixed&gt; &lt;serif&gt; &lt;fraktur&gt;</p>
<p>So, for example, if you use the standard training data, you might end up with a file like this:</p>
<div class="highlight"><pre>eng.arial.box 0 0 0 0 0
eng.arialbd.box 0 1 0 0 0
eng.arialbi.box 1 1 0 0 0
eng.ariali.box 1 0 0 0 0
eng.b018012l.box 0 0 0 1 0
eng.b018015l.box 0 1 0 1 0
eng.b018032l.box 1 0 0 1 0
eng.b018035l.box 1 1 0 1 0
eng.c059013l.box 0 0 0 1 0
eng.c059016l.box 0 1 0 1 0
eng.c059033l.box 1 0 0 1 0
eng.c059036l.box 1 1 0 1 0
eng.cour.box 0 0 1 1 0
eng.courbd.box 0 1 1 1 0
eng.courbi.box 1 1 1 1 0
eng.couri.box 1 0 1 1 0
eng.georgia.box 0 0 0 1 0
eng.georgiab.box 0 1 0 1 0
eng.georgiai.box 1 0 0 1 0
eng.georgiaz.box 1 1 0 1 0
eng.lincoln.box 0 0 0 0 1
eng.old-english.box 0 0 0 0 1
eng.times.box 0 0 0 1 0
eng.timesbd.box 0 1 0 1 0
eng.timesbi.box 1 1 0 1 0
eng.timesi.box 1 0 0 1 0
eng.trebuc.box 0 0 0 1 0
eng.trebucbd.box 0 1 0 1 0
eng.trebucbi.box 1 1 0 1 0
eng.trebucit.box 1 0 0 1 0
eng.verdana.box 0 0 0 0 0
eng.verdanab.box 0 1 0 0 0
eng.verdanai.box 1 0 0 0 0
eng.verdanaz.box 1 1 0 0 0
</pre></div>
<p>Note that this is the standard font_properties file that should be supplied with Tesseract and I’ve added the two bold rows for the blackletter fonts I’m training. You can also see which fonts are included out of the box.</p>
<p>We’re getting near the end. Next, create the clustering data:</p>
<div class="highlight"><pre>mftraining -F font_properties -U unicharset -O lang.unicharset *.tr 
cntraining *.tr
</pre></div>
<p>If you want, you can <a href="http://code.google.com/p/tesseract-ocr/wiki/TrainingTesseract3#Dictionary_Data_(Optional)">create a wordlist</a> or a <a href="http://code.google.com/p/tesseract-ocr/wiki/TrainingTesseract3#The_last_file_(unicharambigs)">unicharambigs file</a>. If you don’t plan on doing that, the last step is to combine the various files we’ve created. </p>
<p>To do that, rename each of the language files (normproto, Microfeat, inttemp, pffmtable) to have your lang prefix, and run (mind the dot at the end):</p>
<div class="highlight"><pre><span class="n">combine_tessdata</span> <span class="n">lang</span><span class="p">.</span>
</pre></div>
<p>This will create all the data files you need, and you just need to move them to the correct place on your <span class="caps">OS</span>. On Ubuntu, I was able to move them to;</p>
<div class="highlight"><pre><span class="n">sudo</span> <span class="n">mv</span> <span class="n">eng</span><span class="p">.</span><span class="n">traineddata</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">tessdata</span><span class="o">/</span>
</pre></div>
<p>And that, good friend, is it. Worst process for a human, ever.</p>
<h2 id="enclosures">Enclosures</h2>
<ul>
<li><a href="http://michaeljaylissner.com/archive/ocr/standard-training-text.txt">Training data file</a></li>
<li><a href="http://michaeljaylissner.com/archive/ocr/old-english.doc">Old English example file</a></li>
</ul>
            
            <section>
<p id="comment-message">I love getting feedback and comments. Make my day by making a comment. </p>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2"
                href="http://michaeljaylissner.com/posts/2012/02/11/adding-new-fonts-to-tesseract-3-ocr-engine/#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'michaeljaylissner';
        var disqus_identifier = 'http://michaeljaylissner.com/posts/2012/02/11/adding-new-fonts-to-tesseract-3-ocr-engine/';
    var disqus_url = 'http://michaeljaylissner.com/posts/2012/02/11/adding-new-fonts-to-tesseract-3-ocr-engine/';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

                </div>
            </div>
        </div>
    </div>
</div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="http://michaeljaylissner.com/posts/2012/01/27/and-the-winning-font-in-court-documents-is/" title="Previous: The Winning Font in Court Opinions">The Winning Font in Court Opinions</a></li>
                <li class="next-article"><a href="http://michaeljaylissner.com/posts/2012/03/15/my-presentation-proposal-for-lvi-2012/" title="Next: My Presentation Proposal for LVI 2012">My Presentation Proposal for LVI 2012</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2012-02-11T10:53:30-08:00">Feb 11, 2012</time>

<h4>Last Updated</h4>
<time datetime="2014-10-06T00:00:00-07:00">Oct 6, 2014</time>

            <h4>Category</h4>
            <a class="category-link" href="http://michaeljaylissner.com/categories.html#tech-ref">Tech</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://michaeljaylissner.com/tags.html#font-ref">Font
                    <span>2</span>
</a></li>
                <li><a href="http://michaeljaylissner.com/tags.html#howto-ref">HowTo
                    <span>4</span>
</a></li>
                <li><a href="http://michaeljaylissner.com/tags.html#ocr-ref">OCR
                    <span>2</span>
</a></li>
                <li><a href="http://michaeljaylissner.com/tags.html#tesseract-ref">Tesseract
                    <span>2</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="http://twitter.com/mlissner" title="My Twitter Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-twitter sidebar-social-links"></i></a>
    <a href="http://github.com/mlissner" title="My Github Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-github sidebar-social-links"></i></a>
    <a href="mailto:mlissner+blog@michaeljaylissner.com" title="My Email Address" class="sidebar-social-links" target="_blank">
    <i class="fa fa-envelope sidebar-social-links"></i></a>
<h4>This is Reader-Editable</h4>
<a href="https://github.com/mlissner/michaeljaylissner.com/edit/master/content/adding-new-fonts-to-tesseract-3-ocr-engine.md">
    <i class="fa fa-github"></i>
    Edit this post on Github
</a><!-- Begin MailChimp Signup Form -->
<div id="mc-embed-signup">
<form action="//asdf.us2.list-manage.com/subscribe/post?u=87204b44efb46f0fd27b95167&amp;id=f511375e11" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
<h4>Get Weekly Updates</h4>
<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="Enter your email..." required>
<div class="clear"><input type="submit" value="Send Me Updates" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
</form>
</div>
<!--End mc_embed_signup-->
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-license">Unless mentioned otherwise, all material on this site is <a href="about#license">licensed</a> under a Creative Commons copyright or the GNU Affero GPL. <a href="about#privacy">Privacy Policy</a>.</li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

            <script type="text/javascript">
var disqus_shortname = 'michaeljaylissner';
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
<script  language="javascript" type="text/javascript">
function uncollapse() {
    if (window.location.hash.match(/^#comment-\d+$/)) {
        $('#disqus_thread').collapse('show');
    }
}
</script>
<script type="text/javascript" language="JavaScript">
uncollapse();
window.onhashchange=function(){
    if (window.location.hash.match(/^#comment-\d+$/))
        window.location.reload(true);
}
</script>
<script>
$('#disqus_thread').on('shown', function () {
    var link = document.getElementsByClassName('accordion-toggle');
    var old_innerHTML = link[0].innerHTML;
    $(link[0]).fadeOut(500, function() {
        $(this).text('Click here to hide comments').fadeIn(500);
    });
    $('#disqus_thread').on('hidden', function () {
        $(link[0]).fadeOut(500, function() {
            $(this).text(old_innerHTML).fadeIn(500);
        });
    })
})
</script>


    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>